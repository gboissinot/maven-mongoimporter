var map_function_version= function (){
 var key = {
    org: this.org,
    name: this.name,
    type: this.type,
    status: this.status
 };
 emit (key , this.version)
}

var reduce_function_version = function(key, values){
     var maxVersion="";
     values.forEach(
        function(value) {
             var valVersion=value;
             valVersionTab = valVersion.split(".");
             var newTab = []
             while (newTab.length!=3) {
             	 if (valVersionTab .length != 0) {
                    newTab.push(valVersionTab.shift());
             	 } else {
                    newTab.push("0");
                 }
             }
             var normailizedVersion = newTab.join(".");
             if (normailizedVersion > maxVersion) {
                 maxVersion = normailizedVersion;
             }
        }
     )
     return maxVersion;
}


db.artifacts.mapReduce(map_function_version,reduce_function_version,{ out: "latest_artifacts" })

db.artifacts.find({org:"wicket",name:"wicket-extensions"},{version:1}).pretty()
db.latest_artifacts.find({_id:{org:"wicket",name:"wicket-extensions",type:"binary",status:"RELEASE"}}).pretty()
