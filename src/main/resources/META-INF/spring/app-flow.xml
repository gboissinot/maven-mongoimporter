<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:task="http://www.springframework.org/schema/task"
       xmlns:int="http://www.springframework.org/schema/integration"
       xmlns:int-mongo="http://www.springframework.org/schema/integration/mongodb"
       xmlns:int-stream="http://www.springframework.org/schema/integration/stream"
       xsi:schemaLocation="
        http://www.springframework.org/schema/task
        http://www.springframework.org/schema/task/spring-task.xsd
        http://www.springframework.org/schema/integration
        http://www.springframework.org/schema/integration/spring-integration.xsd
        http://www.springframework.org/schema/integration/mongodb
        http://www.springframework.org/schema/integration/mongodb/spring-integration-mongodb.xsd
        http://www.springframework.org/schema/integration/stream
        http://www.springframework.org/schema/integration/stream/spring-integration-stream.xsd
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <int:channel id="workingQueue">
        <int:queue capacity="500"/>
    </int:channel>
    <int:channel id="rejectionQueue"/>

    <int:chain input-channel="workingQueue">
        <int:poller
                fixed-delay="1"
                time-unit="SECONDS"
                max-messages-per-poll="100"/>
        <int:filter
                ref="artifactFilter"
                discard-channel="rejectionQueue"/>
        <int-mongo:outbound-channel-adapter
                mongo-converter="mappingConverter"
                mongodb-factory="mongoDbFactory"
                collection-name="artifacts"/>
    </int:chain>

    <bean id="artifactFilter" class="com.boissinot.maven.util.mongoimport.service.ArtifactFilter"/>

    <task:executor id="pool" pool-size="10"/>

    <int-stream:stdout-channel-adapter
            channel="rejectionQueue"
            append-newline="true"/>

    <int-stream:stdout-channel-adapter
            channel="errorChannel"
            append-newline="true"/>

</beans>